<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reddit Media Downloader</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Pixelify+Sans:wght@400..700&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #ff4500;
            --secondary-color: #0079d3;
            --background-color: #f5f8fa;
            --card-color: #ffffff;
            --text-color: #1c1c1c;
            --text-light: #71767b;
            --border-color: #e0e0e0;
            --error-color: #ff5864;
            --success-color: #46d160;
            --warning-color: #ffb800;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            --glass-bg: rgba(255, 255, 255, 0.7);
            --glass-border: rgba(255, 255, 255, 0.18);
        }

        .dark-mode {
            --primary-color: #ff8c5f;
            --secondary-color: #5bacf8;
            --background-color: #121212;
            --card-color: #1e1e1e;
            --text-color: #f0f0f0;
            --text-light: #a0a0a0;
            --border-color: #333333;
            --glass-bg: rgba(30, 30, 30, 0.7);
            --glass-border: rgba(255, 255, 255, 0.1);
        }
        
        body {
            font-family: 'Inter', sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: var(--background-color);
            color: var(--text-color);
            transition: background-color 0.3s ease;
            background-image: url("data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M11 18c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm48 25c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm-43-7c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm63 31c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM34 90c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm56-76c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM12 86c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm28-65c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm23-11c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-6 60c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm29 22c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zM32 63c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm57-13c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-9-21c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM60 91c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM35 41c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM12 60c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2z' fill='%23000000' fill-opacity='0.03' fill-rule='evenodd'/%3E%3C/svg%3E");
        }

        .dark-mode body {
            background-image: url("data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M11 18c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm48 25c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm-43-7c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm63 31c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM34 90c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm56-76c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM12 86c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm28-65c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm23-11c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-6 60c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm29 22c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zM32 63c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm57-13c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-9-21c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM60 91c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM35 41c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM12 60c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2z' fill='%23ffffff' fill-opacity='0.03' fill-rule='evenodd'/%3E%3C/svg%3E");
        }
        
        .container {
            background: var(--glass-bg);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid var(--glass-border);
            padding: 30px;
            border-radius: 16px;
            box-shadow: var(--shadow);
            margin-bottom: 30px;
        }
        
        h1 {
            color: var(--primary-color);
            text-align: center;
            margin-bottom: 10px;
            font-family: 'Pixelify Sans', cursive;
            font-size: 2.8rem;
            font-weight: 700;
        }
        
        .subtitle {
            text-align: center;
            color: var(--text-light);
            margin-bottom: 30px;
            font-weight: 300;
            font-size: 1.2rem;
        }
        
        .form-row {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            margin-bottom: 20px;
            align-items: flex-end;
        }
        
        .form-group {
            flex: 1;
            min-width: 200px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--text-color);
        }
        
        input, select {
            width: 100%;
            padding: 14px;
            border: 1px solid var(--border-color);
            border-radius: 12px;
            box-sizing: border-box;
            font-size: 16px;
            background: var(--card-color);
            color: var(--text-color);
            transition: all 0.3s ease;
        }
        
        input:focus, select:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(255, 69, 0, 0.2);
        }
        
        .checkbox-group {
            display: flex;
            align-items: center;
            margin: 15px 0;
        }
        
        .checkbox-group input {
            width: auto;
            margin-right: 10px;
        }
        
        .button-group {
            display: flex;
            gap: 15px;
            margin-top: 10px;
            flex-wrap: wrap;
        }
        
        button {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 14px 24px;
            border-radius: 12px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(255, 69, 0, 0.3);
        }
        
        button:disabled {
            background-color: var(--text-light);
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .secondary-btn {
            background-color: var(--secondary-color);
        }
        
        .secondary-btn:hover {
            box-shadow: 0 6px 16px rgba(0, 121, 211, 0.3);
        }
        
        .theme-toggle {
            position: absolute;
            top: 20px;
            right: 20px;
        }
        
        .theme-toggle button {
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            color: var(--text-color);
            padding: 10px 15px;
            border-radius: 50px;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }
        
        .progress {
            margin-top: 20px;
            display: none;
        }
        
        .progress-bar {
            height: 12px;
            background-color: var(--border-color);
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 10px;
        }
        
        .progress-bar-inner {
            height: 100%;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
            width: 0%;
            transition: width 0.5s ease;
            border-radius: 10px;
        }
        
        .results {
            margin-top: 30px;
            display: none;
        }
        
        .media-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
            gap: 20px;
            margin: 25px 0;
        }
        
        .media-item {
            border: 1px solid var(--border-color);
            border-radius: 12px;
            overflow: hidden;
            position: relative;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            background: var(--card-color);
        }
        
        .media-item:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow);
        }
        
        .media-item.nsfw {
            border-color: var(--warning-color);
        }
        
        .media-thumbnail {
            width: 100%;
            height: 160px;
            object-fit: cover;
            background: var(--background-color);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-light);
        }
        
        .video-indicator {
            position: absolute;
            top: 10px;
            right: 10px;
            background-color: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 5px 10px;
            border-radius: 6px;
            font-size: 12px;
            display: flex;
            align-items: center;
            gap: 4px;
        }
        
        .nsfw-indicator {
            position: absolute;
            top: 10px;
            left: 10px;
            background-color: var(--warning-color);
            color: white;
            padding: 5px 10px;
            border-radius: 6px;
            font-size: 12px;
            display: flex;
            align-items: center;
            gap: 4px;
        }
        
        .media-info {
            padding: 15px;
        }
        
        .media-title {
            font-size: 14px;
            margin: 0;
            overflow: hidden;
            text-overflow: ellipsis;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            color: var(--text-color);
        }
        
        .message {
            padding: 15px;
            border-radius: 12px;
            margin: 20px 0;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .error {
            background-color: rgba(255, 88, 100, 0.1);
            border: 1px solid var(--error-color);
            color: var(--error-color);
        }
        
        .success {
            background-color: rgba(70, 209, 96, 0.1);
            border: 1px solid var(--success-color);
            color: var(--success-color);
        }
        
        .warning {
            background-color: rgba(255, 184, 0, 0.1);
            border: 1px solid var(--warning-color);
            color: var(--warning-color);
        }
        
        .stats {
            display: flex;
            justify-content: space-between;
            margin: 25px 0;
            padding: 20px;
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            border-radius: 12px;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }
        
        .stat-item {
            text-align: center;
            flex: 1;
        }
        
        .stat-value {
            font-size: 28px;
            font-weight: bold;
            color: var(--primary-color);
            font-family: 'Pixelify Sans', cursive;
        }
        
        .stat-label {
            font-size: 14px;
            color: var(--text-light);
        }
        
        footer {
            text-align: center;
            margin-top: 40px;
            padding: 20px;
            color: var(--text-light);
            font-size: 0.9rem;
            border-top: 1px solid var(--border-color);
        }
        
        .legal {
            max-width: 800px;
            margin: 0 auto;
            line-height: 1.6;
        }
        
        .legal a {
            color: var(--secondary-color);
            text-decoration: none;
        }
        
        .legal a:hover {
            text-decoration: underline;
        }
        
        .icon {
            width: 20px;
            height: 20px;
            display: inline-block;
        }
        
        @media (max-width: 768px) {
            .form-row {
                flex-direction: column;
            }
            
            .media-grid {
                grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
            }
            
            .stats {
                flex-direction: column;
                gap: 20px;
            }
            
            h1 {
                font-size: 2.2rem;
            }
            
            .button-group {
                flex-direction: column;
            }
            
            button {
                width: 100%;
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <div class="theme-toggle">
        <button id="themeToggle">
            <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
            </svg>
            <span id="themeText">Dark Mode</span>
        </button>
    </div>

    <div class="container">
        <h1>Reddit Media Downloader</h1>
        <p class="subtitle">Download images and videos from any Reddit user's posts</p>
        
        <div class="form-row">
            <div class="form-group">
                <label for="username">Reddit Username:</label>
                <input type="text" id="username" placeholder="Enter Reddit username (without u/)" required>
            </div>
            
            <div class="form-group">
                <label for="limit">Number of Posts to Check (max 1000):</label>
                <input type="number" id="limit" value="100" min="1" max="1000">
            </div>
            
            <div class="form-group">
                <label for="contentType">Content Type:</label>
                <select id="contentType">
                    <option value="all">All Media</option>
                    <option value="images">Images Only</option>
                    <option value="videos">Videos Only</option>
                </select>
            </div>
        </div>
        
        <div class="checkbox-group">
            <input type="checkbox" id="includeNsfw">
            <label for="includeNsfw">Include NSFW content</label>
        </div>
        
        <div class="button-group">
            <button id="fetchBtn">
                <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M21 12a9 9 0 0 1-9 9m9-9a9 9 0 0 0-9-9m9 9H3m9 9a9 9 0 0 1-9-9m9 9c1.66 0 3-4.03 3-9s-1.34-9-3-9m0 18c-1.66 0-3-4.03-3-9s1.34-9 3-9m-9 9a9 9 0 0 1 9-9"></path>
                </svg>
                Fetch Media
            </button>
            
            <button id="downloadBtn" class="secondary-btn" style="display: none;">
                <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                    <polyline points="7 10 12 15 17 10"></polyline>
                    <line x1="12" y1="15" x2="12" y2="3"></line>
                </svg>
                Download All
            </button>
        </div>
        
        <div class="progress" id="progress">
            <div class="progress-bar">
                <div class="progress-bar-inner" id="progressBar"></div>
            </div>
            <div id="progressText">Processing...</div>
        </div>
        
        <div class="message error" id="error" style="display: none;">
            <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <circle cx="12" cy="12" r="10"></circle>
                <line x1="12" y1="8" x2="12" y2="12"></line>
                <line x1="12" y1="16" x2="12.01" y2="16"></line>
            </svg>
            <span id="errorText"></span>
        </div>
        
        <div class="message success" id="success" style="display: none;">
            <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
                <polyline points="22 4 12 14.01 9 11.01"></polyline>
            </svg>
            <span id="successText"></span>
        </div>
        
        <div class="message warning" id="warning" style="display: none;">
            <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path>
                <line x1="12" y1="9" x2="12" y2="13"></line>
                <line x1="12" y1="17" x2="12.01" y2="17"></line>
            </svg>
            <span id="warningText"></span>
        </div>
        
        <div class="results" id="results">
            <h2>Media Found</h2>
            
            <div class="stats">
                <div class="stat-item">
                    <div class="stat-value" id="totalCount">0</div>
                    <div class="stat-label">Total Media</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="imagesCount">0</div>
                    <div class="stat-label">Images</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="videosCount">0</div>
                    <div class="stat-label">Videos</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="nsfwCount">0</div>
                    <div class="stat-label">NSFW</div>
                </div>
            </div>
            
            <div class="media-grid" id="mediaGrid"></div>
        </div>
    </div>

    <footer>
        <div class="legal">
            <p><strong>Legal Notice:</strong> This tool is designed for personal use only. Users are responsible for ensuring they have the right to download and use any content. 
            Respect copyright laws and Reddit's terms of service. Do not download or distribute content without proper authorization from the copyright holder.</p>
            <p>Reddit is a trademark of Reddit, Inc. This application is not affiliated with or endorsed by Reddit, Inc.</p>
            <p>\C2\A9 2023 Reddit Media Downloader. All rights reserved. | 
   <a href="https://github.com/Killersparrow1/reddit-media-downloader-V1.1" target="_blank">
       GitHub Repository
   </a>
          </p>
        </div>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const usernameInput = document.getElementById('username');
            const limitInput = document.getElementById('limit');
            const contentTypeSelect = document.getElementById('contentType');
            const includeNsfwCheckbox = document.getElementById('includeNsfw');
            const fetchBtn = document.getElementById('fetchBtn');
            const downloadBtn = document.getElementById('downloadBtn');
            const progress = document.getElementById('progress');
            const progressBar = document.getElementById('progressBar');
            const progressText = document.getElementById('progressText');
            const errorDiv = document.getElementById('error');
            const errorText = document.getElementById('errorText');
            const successDiv = document.getElementById('success');
            const successText = document.getElementById('successText');
            const warningDiv = document.getElementById('warning');
            const warningText = document.getElementById('warningText');
            const resultsDiv = document.getElementById('results');
            const mediaGrid = document.getElementById('mediaGrid');
            const totalCount = document.getElementById('totalCount');
            const imagesCount = document.getElementById('imagesCount');
            const videosCount = document.getElementById('videosCount');
            const nsfwCount = document.getElementById('nsfwCount');
            const themeToggle = document.getElementById('themeToggle');
            const themeText = document.getElementById('themeText');
            
            let mediaUrls = [];
            let currentTheme = localStorage.getItem('theme') || 'light';
            
            // Set initial theme
            if (currentTheme === 'dark') {
                document.body.classList.add('dark-mode');
                themeText.textContent = 'Light Mode';
            } else {
                themeText.textContent = 'Dark Mode';
            }
            
            // Theme toggle functionality
            themeToggle.addEventListener('click', function() {
                document.body.classList.toggle('dark-mode');
                if (document.body.classList.contains('dark-mode')) {
                    localStorage.setItem('theme', 'dark');
                    themeText.textContent = 'Light Mode';
                } else {
                    localStorage.setItem('theme', 'light');
                    themeText.textContent = 'Dark Mode';
                }
            });
            
            fetchBtn.addEventListener('click', fetchMedia);
            downloadBtn.addEventListener('click', downloadMedia);
            
            function fetchMedia() {
                const username = usernameInput.value.trim();
                const limit = parseInt(limitInput.value);
                const contentType = contentTypeSelect.value;
                const includeNsfw = includeNsfwCheckbox.checked;
                
                if (!username) {
                    showError('Please enter a username');
                    return;
                }
                
                // Reset UI
                hideMessages();
                resultsDiv.style.display = 'none';
                downloadBtn.style.display = 'none';
                progress.style.display = 'block';
                progressBar.style.width = '0%';
                progressText.textContent = 'Fetching media...';
                fetchBtn.disabled = true;
                
                // Make API request
                fetch('/fetch_media', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        username: username,
                        limit: limit,
                        content_type: contentType,
                        include_nsfw: includeNsfw
                    })
                })
                .then(response => response.json())
                .then(data => {
                    if (data.error) {
                        showError(data.error);
                        return;
                    }
                    
                    mediaUrls = data.media_urls || [];
                    
                    // Update stats
                    updateStats(mediaUrls);
                    
                    // Display media grid
                    displayMediaGrid(mediaUrls);
                    
                    resultsDiv.style.display = 'block';
                    progress.style.display = 'none';
                    fetchBtn.disabled = false;
                    
                    if (mediaUrls.length > 0) {
                        downloadBtn.style.display = 'flex';
                    }
                    
                    if (mediaUrls.length === 0) {
                        showWarning('No media found for this user with the current filters');
                    } else {
                        showSuccess(`Found ${mediaUrls.length} media items`);
                    }
                })
                .catch(error => {
                    showError('Error fetching media: ' + error.message);
                    progress.style.display = 'none';
                    fetchBtn.disabled = false;
                });
            }
            
            function updateStats(media) {
                totalCount.textContent = media.length;
                
                const images = media.filter(m => m.type === 'image').length;
                const videos = media.filter(m => m.type === 'video' || m.type === 'gif').length;
                const nsfw = media.filter(m => m.nsfw).length;
                
                imagesCount.textContent = images;
                videosCount.textContent = videos;
                nsfwCount.textContent = nsfw;
            }
            
            function displayMediaGrid(media) {
                mediaGrid.innerHTML = '';
                
                media.forEach(item => {
                    const mediaItem = document.createElement('div');
                    mediaItem.className = `media-item ${item.nsfw ? 'nsfw' : ''}`;
                    
                    let thumbnailContent = '';
                    if (item.type === 'image') {
                        thumbnailContent = `<img src="${item.url}" alt="${item.title}" class="media-thumbnail" onerror="this.style.display='none'; this.parentNode.innerHTML='<div class=\'media-thumbnail\'>Image failed to load</div>';">`;
                    } else if (item.type === 'video' || item.type === 'gif') {
                        thumbnailContent = `<div class="media-thumbnail">Video content</div>`;
                    } else {
                        thumbnailContent = `<div class="media-thumbnail">Unsupported content</div>`;
                    }
                    
                    mediaItem.innerHTML = `
                        ${thumbnailContent}
                        ${item.type === 'video' || item.type === 'gif' ? `
                            <div class="video-indicator">
                                <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <polygon points="23 7 16 12 23 17 23 7"></polygon>
                                    <rect x="1" y="5" width="15" height="14" rx="2" ry="2"></rect>
                                </svg>
                                VIDEO
                            </div>
                        ` : ''}
                        ${item.nsfw ? `
                            <div class="nsfw-indicator">
                                <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <circle cx="12" cy="12" r="10"></circle>
                                    <line x1="12" y1="8" x2="12" y2="12"></line>
                                    <line x1="12" y1="16" x2="12.01" y2="16"></line>
                                </svg>
                                NSFW
                            </div>
                        ` : ''}
                        <div class="media-info">
                            <p class="media-title">${item.title}</p>
                        </div>
                    `;
                    
                    mediaGrid.appendChild(mediaItem);
                });
            }
            
            function downloadMedia() {
                const username = usernameInput.value.trim();
                
                if (mediaUrls.length === 0) {
                    showError('No media to download');
                    return;
                }
                
                // Reset UI
                hideMessages();
                progress.style.display = 'block';
                progressBar.style.width = '0%';
                progressText.textContent = 'Preparing download...';
                downloadBtn.disabled = true;
                fetchBtn.disabled = true;
                
                // Make API request
                fetch('/download_media', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        username: username,
                        media_urls: mediaUrls
                    })
                })
                .then(response => response.json())
                .then(data => {
                    if (data.error) {
                        showError(data.error);
                        return;
                    }
                    
                    progressText.textContent = 'Download ready!';
                    progressBar.style.width = '100%';
                    
                    // Download the zip file
                    setTimeout(() => {
                        window.location.href = `/download_zip/${data.zip_file}`;
                        progress.style.display = 'none';
                        downloadBtn.disabled = false;
                        fetchBtn.disabled = false;
                        showSuccess(`Downloaded ${data.downloaded_count} files`);
                    }, 1000);
                })
                .catch(error => {
                    showError('Error downloading media: ' + error.message);
                    progress.style.display = 'none';
                    downloadBtn.disabled = false;
                    fetchBtn.disabled = false;
                });
            }
            
            function showError(message) {
                errorText.textContent = message;
                errorDiv.style.display = 'flex';
            }
            
            function showSuccess(message) {
                successText.textContent = message;
                successDiv.style.display = 'flex';
            }
            
            function showWarning(message) {
                warningText.textContent = message;
                warningDiv.style.display = 'flex';
            }
            
            function hideMessages() {
                errorDiv.style.display = 'none';
                successDiv.style.display = 'none';
                warningDiv.style.display = 'none';
            }
        });
    </script>
</body>
</html>
